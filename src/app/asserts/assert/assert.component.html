<div class="grid-2" *ngIf="data && !loading">
  <div class="form-container colum1">
    <div class="title-section">
      <h5 class="w-fit">
        {{title}}
      </h5>
      <div class="d-flex">
        <a class="btn btn-light" [routerLink]="page.listUrl">
          <i class="bi bi-arrow-left"></i>
          Back
        </a>
      </div>
    </div>
    <form class="body">
      <div class="grid-2">
        <!-- Name -->
        <div class="form-floating mb-4">
          <input
            type="text"
            class="form-control"
            id="name"
            placeholder="Name"
            [(ngModel)]="data.name"
            [ngModelOptions]="{ standalone: true }"
            required
          />
          <label for="name">Name</label>
        </div>

        <div class="form-floating mb-4">
          <input
            type="text"
            class="form-control"
            id="code"
            placeholder="Code"
            [(ngModel)]="data.code"
            [ngModelOptions]="{ standalone: true }"
            required
          />
          <label for="code">Code</label>
        </div>
      </div>

      <div class="grid-2">
        <!-- Category -->
        <div class="form-floating mb-4" *ngIf="categories.length">
          <select
            class="form-select"
            id="categoryId"
            [(ngModel)]="data.categoryId"
            [ngModelOptions]="{ standalone: true }"
            (change)="filterAssetTypes()"
            required
          >
            <option value="" disabled selected>Select Asset</option>
            <option [value]="category.id" *ngFor="let category of categories">
              {{ category.name }}
            </option>
          </select>
          <label for="transactionType">Category</label>
        </div>

        <!-- Asset Type -->
        <div class="form-floating mb-4" *ngIf="assetTypes">
          <select
            class="form-select"
            id="assetTypeId"
            [(ngModel)]="data.assetTypeId"
            [ngModelOptions]="{ standalone: true }"
            required
          >
            <option value="" disabled selected>Select Asset Type</option>
            <option
              [value]="assetType.id"
              *ngFor="let assetType of assetTypes"
            >
              {{ assetType.name }}
            </option>
          </select>
          <label for="assetTypeId">Asset Type</label>
        </div>
      </div>

      <div class="grid-2">
        <!-- Stock in Hand -->
        <div class="form-floating mb-4" *ngIf="data.id">
          <input
            type="number"
            class="form-control"
            id="stockInHand"
            placeholder="Stock In Hand"
            [(ngModel)]="data.stockInHand"
            [ngModelOptions]="{ standalone: true }"
            required
            readonly
          />
          <label for="stockInHand"> Running Stock </label>
        </div>

        <!-- Minimum Stock Alert -->
        <div class="form-floating mb-4">
          <input
            type="number"
            class="form-control"
            id="minimumStockAlert"
            placeholder="Minimum Stock Alert"
            [(ngModel)]="data.metadata.minimumStockAlert"
            [ngModelOptions]="{ standalone: true }"
            required
          />
          <label for="minimumStockAlert">Minimum Stock Alert</label>
        </div>

        <!-- Serial number -->
        <div class="form-floating mb-4">
          <input
            type="text"
            class="form-control"
            id="serialNumber"
            placeholder="Serial Number"
            [(ngModel)]="data.metadata.serialNumber"
            [ngModelOptions]="{ standalone: true }"
            required
          />
          <label for="serialNumber">Serial Number</label>
        </div>
      </div>

      <button type="submit" class="w-100 btn btn-primary mb-2" (click)="save()">
        Save
      </button>
    </form>
  </div>

  <div class="colum2" *ngIf="data.id">
    <div class="form-container mb-4">
      <div class="body">
        <h6 class="mb-2">Other Actions</h6>
        <ul class="list-group">
          <li
            class="list-group-item pointer bg-dark text-light"
            (click)="onRestock(data)"
          >
            <i class="bi bi-box-arrow-in-down"></i> Receive Stock
          </li>

          <li
            class="list-group-item pointer bg-dark text-light"
            (click)="onUsage(data)"
          >
            <i class="bi bi-box-arrow-up"></i> Issue Out
          </li>
        </ul>
        <app-transaction
          *ngIf="selectedAsset && transaction"
          [assert]="selectedAsset"
          [data]="transaction"
          [transactionType]="transactionType"
          (onClose)="selectedAsset = undefined"
          [isAdd]="true"
          itemId="add"
        />
      </div>
    </div>

    <div class="form-container">
      <div class="body">
        <h6 class="mb-2">Transaction History</h6>

        <!-- This is used to display the transaction history of the asset -->
        <app-asset-transactions
          [assetId]="data.id"
          [list]="data.transactions || []"
          (refreshAsset)="refreshAsset()"
        />

        <!-- This is used to create a new transaction -->
        <app-transaction
          *ngIf="selectedAsset && transaction"
          [assert]="selectedAsset"
          [data]="transaction"
          [transactionType]="transactionType"
          (onClose)="selectedAsset = undefined; refreshAsset()"
          [isAdd]="true"
          itemId="add"
        />
      </div>
    </div>
  </div>
</div>

<app-loader *ngIf="loading"/>